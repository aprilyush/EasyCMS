//------------------------------------------------------------------------------
// 作者：Generated by easycms
// 时间：{$gentime}
//------------------------------------------------------------------------------
using Atlass.Framework.Common;
using Atlass.Framework.Models.Admin;
using Atlass.Framework.ViewModels.Common;
using Microsoft.Extensions.DependencyInjection;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;



namespace Atlass.Framework.AppService
{
    /// <summary>
    /// {$table.remark}
    ///</summary>
    public class {$upperTableName}AppService
    {

        private readonly IFreeSql Sqldb;
        public {$upperTableName}AppService(IServiceProvider service)
        {
            Sqldb = service.GetRequiredService<IFreeSql>();
        }
        

         /// <summary>
         /// 数据列表
         ///</summary>
        public DataTableDto GetPageList(DataTableDto param)
        {
            
            var query = Sqldb.Select<{$table.table_name}>()
                .OrderByDescending(s => s.create_time)
                .Count(out long total)
                .Page(param.pageNumber, param.pageSize)
                .ToList();
            param.total = total;
            param.rows = query;
            return param;
        }

        /// <summary>
        /// 保存数据
        /// </summary>
        /// <param name="dto"></param>

        public void Save({$table.table_name} dto,LoginUserDto user)
        {
           
            dto.update_by = user.LoginName;
            dto.update_time = DateTime.Now;
            if (dto.id == 0)
            {
                dto.create_by = user.LoginName;
                dto.create_time = DateTime.Now;
                Sqldb.Insert(dto).ExecuteAffrows();
            }
            else
            {
                Sqldb.Update<{$table.table_name}>().SetSource(dto).ExecuteAffrows();
            }
           
        }

        /// <summary>
        /// 获取{$table.remark}信息
        ///</summary>
        public {$table.table_name} GetModel(int id)
        {
            return Sqldb.Queryable<{$table.table_name}>().Where(s => s.id == id).First();
        }

         /// <summary>
         /// 删除信息信息
         ///</summary>
        public void RemoveAll(string ids)
        {
            var idsArray = ids.SplitToArrayInt();
            Sqldb.Delete<{$table.table_name}>().Where(s => idsArray.Contains(s.id)).ExecuteAffrows();
        }

    }
    
}
